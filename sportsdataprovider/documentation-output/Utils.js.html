<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Utils.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileOverview 	I provide generic Utility methods.
 * @author 			John Allen &lt;jallen@bbg.gov>
 * @version 		1.0.0
 * @module 			Utils.js
 */

/* *************************** Required Classes **************************** */
var fs = require('fs');

/* *************************** Constructor Code **************************** */

/* *************************** Public Methods ****************************** */

/**
 * I format a date from OPTA that is sometimes in the YYYYMMDDTHHmmssZZ format
 * to YYYY-MM-DDTHH:mm:ssZZ format so it's easer to work wiht and a valid 
 * Javascript format
 * @param {String} theDate - I am the string to convert
 * @return {string} - the formated date.
 */
function formatOptaDate( theDate ){
	
	theDate = theDate.splice(4,0,'-');
	theDate = theDate.splice(7,0,'-');
	theDate = theDate.splice(13,0,':');
	theDate = theDate.splice(16,0,':');
	
	return theDate;
}


/**
 * I delete the contents of a directory
 * @param {String} dirPath - I am the path of the directory to empty
 * @return {void}
 */
function emptyDirectory( dirPath ) {
  try { var files = fs.readdirSync(dirPath); }
  catch(e) { return; }
  if (files.length > 0)
    for (var i = 0; i &lt; files.length; i++) {
      var filePath = dirPath + '/' + files[i];
      if (fs.statSync(filePath).isFile())
        fs.unlinkSync(filePath);
      else
        deleteDirectory(filePath);
    }
};


/**
 * I recursivly delete a directory
 * @param {String} dirPath - I am the path of the directory to delete
 * @return {void}
 */
function deleteDirectory( dirPath ) {
  try { var files = fs.readdirSync(dirPath); }
  catch(e) { return; }
  if (files.length > 0)
    for (var i = 0; i &lt; files.length; i++) {
      var filePath = dirPath + '/' + files[i];
      if (fs.statSync(filePath).isFile())
        fs.unlinkSync(filePath);
      else
        deleteDirectory(filePath);
    }
  fs.rmdirSync(dirPath);
};


/**
 * I search JSON objects.
 * @param {String} Path - I am the name of the node to search for.
 						  Examples can be:
 						  MainDatContainer.NodeToFind
 						  or even pass in array positions like:
 						  UberParent.ChildArray[0].NodeToFind
 * @param {Object} data - I am the JSON object to be searched.
 */
function objectSearch(path, obj) {
	var path = path.split(".");
	var item = path.shift();
	if(item.indexOf("]") == item.length-1) {
		// array
		item = item.split("[");
		var arrayName = item.shift();
		//console.log(item)
		var arrayIndex = parseInt(item.shift().replace("]", ""));
		var arr = obj[arrayName || ""];
		if(arr &amp;&amp; arr[arrayIndex]) {
			return this.objectSearch(path.join("."), arr[arrayIndex]);
		} else {
			return null;
		}
	} else {
		// object
		if(obj[item]) {
			if(path.length === 0) {
				return obj[item];
			} else {
				return this.objectSearch(path.join("."), obj[item]);
			}
		} else {
			return null;
		}
	}
}


// Changes XML to JSON
function xmlToJson(xml) {
	
	// Create the return object
	var obj = {};

	if (xml.nodeType == 1) { // element
		// do attributes
		if (xml.attributes.length > 0) {
		obj["@attributes"] = {};
			for (var j = 0; j &lt; xml.attributes.length; j++) {
				var attribute = xml.attributes.item(j);
				obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
			}
		}
	} else if (xml.nodeType == 3) { // text
		obj = xml.nodeValue;
	}

	// do children
	if (xml.hasChildNodes()) {
		for(var i = 0; i &lt; xml.childNodes.length; i++) {
			var item = xml.childNodes.item(i);
			var nodeName = item.nodeName;
			if (typeof(obj[nodeName]) == "undefined") {
				obj[nodeName] = xmlToJson(item);
			} else {
				if (typeof(obj[nodeName].push) == "undefined") {
					var old = obj[nodeName];
					obj[nodeName] = [];
					obj[nodeName].push(old);
				}
				obj[nodeName].push(xmlToJson(item));
			}
		}
	}
	return obj;
};


function Left(str, n){
	if (n &lt;= 0)
		return "";
	else if (n > String(str).length)
		return str;
	else
		return String(str).substring(0,n);
}

function Right(str, n){
	if (n &lt;= 0)
		return "";
	else if (n > String(str).length)
		return str;
	else {
		var iLen = String(str).length;
		return String(str).substring(iLen, iLen - n);
	}
}

// add a contains function
String.prototype.contains = function(it) { 
	return this.indexOf(it) != -1; 
};

// add a splice function
String.prototype.splice = function( idx, rem, s ) {
    return (this.slice(0,idx) + s + this.slice(idx + Math.abs(rem)));
};


/* ************************ Exported Public Methods ************************ */
exports.objectSearch = objectSearch;
exports.xmlToJson = xmlToJson;
exports.Left = Left;
exports.Right = Right;
exports.formatOptaDate = formatOptaDate;
exports.deleteDirectory = deleteDirectory;
exports.emptyDirectory = emptyDirectory;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="js.html">AggregateDataService.js</a></li><li><a href="js_.html">app.js</a></li><li><a href="js__.html">Config.js</a></li><li><a href="js___.html">Controller.js</a></li><li><a href="js____.html">Email.js</a></li><li><a href="js_____.html">ErrorHandler.js</a></li><li><a href="js______.html">FayeService.js</a></li><li><a href="js_______.html">JSONFileService.js</a></li><li><a href="js________.html">Logger.js</a></li><li><a href="js_________.html">Lookup.js</a></li><li><a href="js__________.html">OutputService.js</a></li><li><a href="js___________.html">Transformer.js</a></li><li><a href="js____________.html">Utils.js</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Wed Oct 01 2014 16:22:01 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
